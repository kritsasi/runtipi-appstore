{
  "services": [
    {
      "name": "openflow",
      "image": "openiap/openflow:1.5.12.29",
      "environment": {
        "protocol": "${APP_PROTOCOL}",
        "domain": "${APP_DOMAIN}",
        "cookie_secret": "${OPENFLOW_COOKIE_SECRET}",
        "aes_secret": "${OPENFLOW_AES_SECRET}"
      },
      "internalPort": 80,
      "dependsOn": {
        "openflow-db": {
          "condition": "service_healthy"
        },
        "openflow-mq": {
          "condition": "service_healthy"
        }
      },
      "isMain": true
    },
    {
      "name": "openflow-db",
      "image": "mongo:6.0",
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/mongo",
          "containerPath": "/data/db",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthCheck": {
        "test": "mongosh --quiet --eval 'db.runCommand({ ping: 1 }).ok' | grep 1",
        "interval": "10s",
        "timeout": "5s",
        "retries": 10
      }
    },
    {
      "name": "openflow-mq",
      "image": "rabbitmq:3-management",
      "environment": {
        "RABBITMQ_DEFAULT_USER": "${OPENFLOW_MQ_USER}",
        "RABBITMQ_DEFAULT_PASS": "${OPENFLOW_MQ_PASS}"
      },
      "volumes": [
        {
          "hostPath": "${APP_DATA_DIR}/data/rabbitmq",
          "containerPath": "/var/lib/rabbitmq",
          "readOnly": false,
          "shared": false,
          "private": false
        }
      ],
      "healthCheck": {
        "test": "rabbitmq-diagnostics -q ping",
        "interval": "10s",
        "timeout": "5s",
        "retries": 10
      }
    }
  ]
}
